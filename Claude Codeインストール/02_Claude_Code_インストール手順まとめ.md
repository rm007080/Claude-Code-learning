# Claude Code インストール手順まとめ

このドキュメントは、Windows上のCursorエディタ環境にClaude Code（ターミナル版）をインストールし、利用可能にするまでの一連のトラブルシューティングとセットアップ手順をまとめたものです。

## 概要

当初の目的は、CursorエディタにClaude Code拡張機能をインストールすることでした。しかし、プロセスを進める中で以下の課題が明らかになり、段階的な解決が必要となりました。

1.  **Windows非対応**: Claude CodeのコアツールはWindowsにネイティブ対応しておらず、Linux環境が必要。
2.  **環境の競合**: ターミナルで実行するコアツール（CLI版）と、VS CodeマーケットプレースからインストールするGUI連携用の拡張機能は別物であり、両者の設定が干渉していた。

最終的に、Windows Subsystem for Linux (WSL) を導入してLinux環境を構築し、そちらにCLI版をインストール。PowerShellからシームレスに呼び出せるように設定することで、安定した開発環境を構築しました。

---

## 1. 初期段階と最初の障壁

### 試行と結果

1.  **CursorへのVSIXファイルインストール試行**:
    *   **試したこと**: Claude Code本体がPCにインストール済みと想定し、拡張機能ファイル（.vsix）をCursorにドラッグ＆ドロップする方法を検討しました。
    *   **結果**: ユーザーは本体が未インストールだったため、この方法は実行できませんでした。

2.  **Windowsへの直接インストール試行**:
    *   **試したこと**: `npm install -g @anthropic-ai/claude-code` コマンドをPowerShellで直接実行しました。
    *   **結果**: 以下の2段階のエラーで失敗。
        1.  PCにNode.js/npmがインストールされていなかった。
        2.  Node.jsインストール後も、`Error: Claude Code is not supported on Windows.` というエラーが発生。

### 明らかになったこと

**Claude CodeはWindowsネイティブでは動作せず、Linux環境が必須である。**

---

## 2. WSL (Windows Subsystem for Linux) の導入

Windows上でLinux環境を構築するため、WSLの導入を決定しました。

### セットアップ手順

1.  **WSLインストール**:
    *   PowerShellで `wsl --install` コマンドを実行。
    *   PCの再起動が必要となりました。

2.  **Ubuntuの初期設定**:
    *   再起動後、Ubuntu（Linuxディストリビューション）のセットアップが自動で開始されなかったため、再度 `wsl` コマンドを実行して手動で起動。
    *   Linux環境で使用する新しい **ユーザー名** と **パスワード** を設定し、初期化を完了させました。

---

## 3. Linux環境内へのツールインストール

新しく構築したWSL/Ubuntu環境内に、Claude Codeの実行に必要なツールをインストールしました。

### セットアップ手順

1.  **パッケージリスト更新**:
    *   `sudo apt update` を実行し、パッケージ情報を最新化しました。

2.  **nvm (Node Version Manager) のインストール**:
    *   システムの安全性を考慮し、`sudo`（管理者権行）での直接インストールを避けるため、`nvm`を利用しました。
    *   `curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash` を実行して`nvm`をインストール。

3.  **Node.jsとnpmのインストール**:
    *   `nvm install --lts` を実行し、推奨版のNode.jsとnpmをユーザーのホームディレクトリ内にセットアップしました。

4.  **Claude Code本体のインストール**:
    *   `npm install -g @anthropic-ai/claude-code` コマンドをWSL/Ubuntu環境内で実行し、インストールに成功しました。

---

## 4. PowerShellからの起動設定とトラブルシューティング

利便性のために、WindowsのPowerShellから直接 `claude` コマンドを呼び出せるように設定を試みましたが、ここで混乱が生じました。

### 発生した問題

*   **現象**: PowerShellのプロファイル（`$PROFILE`）に `function claude { wsl claude }` のような関数を定義しても、`bash: line 1: claude: command not found` というエラーが繰り返し発生しました。
*   **原因**:
    1.  PowerShellから非対話的にWSLを呼び出す際、Linuxの環境設定ファイル（`.bashrc`など）が正しく読み込まれず、`claude`コマンドのパスが認識されていませんでした。
    2.  この調査過程で、ユーザーがVS Codeマーケットプレースから **GUI連携用の「Claude Code」拡張機能** を別途インストールしていたことが判明。この拡張機能が、手動で設定しようとしていたPowerShellの関数と競合し、問題を複雑化させていました。

---

## 5. 方針の明確化と最終的な環境構築

ここで、2種類の「Claude Code」が存在することを明確にしました。

| 種類 | 特徴 | メリット | デメリット |
| :--- | :--- | :--- | :--- |
| **ターミナル版 (CLI)** | コマンドラインでAIと対話する専門ツール | 高機能、プロジェクト全体を深く分析できる | 操作がやや専門的 |
| **拡張機能 (GUI)** | CursorのUIに統合されたAIアシスタント | 手軽、GUIで直感的に使える | 機能が限定的 |

ユーザーは、両者を比較検討した上で、よりパワフルな **「ターミナル版」** をメインで利用することを選択しました。

### 最終的な環境設定

1.  **GUI拡張機能の無効化**:
    *   競合の原因となっていたCursorのGUI用拡張機能を無効化しました。

2.  **PowerShellプロファイルの修正**:
    *   PowerShellプロファイル（`$PROFILE`）の内容を、以下の最も確実な記述に修正しました。
        ```powershell
        function claude {
            wsl.exe -e bash -ic "claude"
        }
        ```
    *   **ポイント**: `-ic` オプションを付けることで、WSL起動時にLinuxのシェル設定（`.bashrc`）が確実に読み込まれ、コマンドのパスが正しく解決されるようになります。

### 完成した環境

この設定により、PowerShellで `claude` と入力するだけで、安定してターミナル版Claude Codeが起動する環境が完成しました。

---

## 6. 補足事項

*   **料金**: ユーザーはClaudeのProプラン（月額固定）を契約済みのため、ターミナル版の利用で追加の従量課金は発生しません。
*   **`/init` コマンド**: このコマンドは、プロジェクトの初期設定時に一度だけ実行すればよく、毎回入力する必要はありません。
*   **使い方**: `claude` コマンドでターミナル版を起動し、AIとの対話を通じてプロジェクトの分析や質問応答が正常に行えることを確認しました。 