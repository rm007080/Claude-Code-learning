はい、承知いたしました。
これまでの長い道のり、本当にお疲れ様でした。後からご自身やチームのメンバーが見返しても状況を正確に思い出せるように、ここまでの対応内容を詳細かつ網羅的に整理し、マークダウン形式で提供します。

---

# Cursor と Claude Code の連携設定：セットアップ対応議事録

## 1. 目的と最終ゴール

本件の目的は、Windows上のCursorエディタでAnthropic社のAIコーディングアシスタント`Claude Code`を利用可能にすることでした。
当初はGUIのアイコンから起動するAIチャット機能の導入を想定していましたが、対話を通じて`Claude Code`には2種類のアプローチがあることが判明しました。

1.  **GUI連携型:** Cursor内蔵のAIチャット機能の頭脳としてClaudeモデルを利用する、手軽なアシスタント。
2.  **ターミナル版:** コマンドラインでAIと対話し、より高度で自律的な開発作業を行える専門ツール。

最終的に、よりパワフルで多機能な**「2. ターミナル版 `Claude Code`」**をメインのツールとして利用する方針を決定し、そのための環境を構築しました。

## 2. 発生した事象と対策のタイムライン

セットアップ過程で発生した主な事象と、それに対する具体的な対策を時系列で整理します。

### Phase 1: Windowsへの直接インストールと最初の障壁

| 現象 | 原因 | 対策 |
| :--- | :--- | :--- |
| **1. `npm`コマンドエラー** | PCにNode.js（および、そのパッケージ管理ツールである`npm`）がインストールされていなかった。 | Node.jsの公式サイトからインストーラーをダウンロードし、インストールを実行した。 |
| **2. Windows非対応エラー** | `Claude Code`本体は、Windows OSにネイティブ対応しておらず、LinuxまたはmacOS環境を要求する。 | Windows上でLinux環境を構築できる**WSL (Windows Subsystem for Linux)**を導入する方針に転換した。 |

### Phase 2: WSL (Windows Subsystem for Linux) のセットアップ

| 現象 | 原因 | 対策 |
| :--- | :--- | :--- |
| **3. PCの再起動要求** | WSLのようなOSの根幹に関わる機能を有効化したため、システム設定の反映に再起動が必要となった。 | PCを再起動した。 |
| **4. Ubuntuの自動セットアップが開始されない** | 再起動後にLinuxディストリビューション（Ubuntu）の初期設定が自動で起動しなかった。 | `wsl --install Ubuntu`コマンドを手動で実行し、インストールを再試行した。 |
| **5. 「ディストリビューションは既に存在」エラー** | 実際にはUbuntuのインストールは完了しており、初期設定待ちの状態だった。 | `wsl`コマンドでUbuntuを起動し、Linux環境用の**新しいユーザー名とパスワード**を設定して初期化を完了させた。 |

### Phase 3: Linux環境への `Claude Code` 本体インストール

| 現象 | 原因 | 対策 |
| :--- | :--- | :--- |
| **6. Linux環境に開発ツールがない** | 新しく作成したUbuntu環境には、Node.jsやnpmがインストールされていなかった。 | **安全な`sudo`なしインストール**を採用。<br>1. `sudo apt update`でパッケージリストを更新。<br>2. `nvm`(Node Version Manager)を導入。<br>3. `nvm`経由でNode.jsとnpmを**ユーザーのホームディレクトリ内**にインストール。これにより、システムのパーミッション問題を回避した。 |
| **7. `Claude Code`インストール成功** | 上記手順により前提条件が整った。 | Linux環境内で`npm install -g @anthropic-ai/claude-code`を実行し、`Claude Code`本体のインストールに成功した。 |

### Phase 4: PowerShellからの起動と混乱の核心

| 現象 | 原因 | 対策 |
| :--- | :--- | :--- |
| **8. `claude: command not found`エラー** | PowerShellから`wsl`経由で`claude`を呼び出した際、Linux環境が`claude`の場所を見つけられなかった。 | PowerShellプロファイル(`$PROFILE`)に、`claude`という名前の関数を定義。当初`source ~/.profile`を試したが解決せず、`source ~/.bashrc`に修正するなどの試行錯誤を行った。 |
| **9. GUI用拡張機能との競合** | ユーザー様がCursorマーケットプレースから**GUI連携用の`Claude Code`拡張機能**を別途インストールしていたことが判明。この拡張機能の設定が、私たちが手動で設定しようとしていたPowerShellの関数と**競合**し、エラーを引き起こしていた。 | この時点で、**2種類の「Claude Code」が存在すること**を明確化し、どちらをメインで使いたいかの意思決定を仰いだ。 |

### Phase 5: 「ターミナル版」を選択し、環境を最終整備

| 現象 | 原因 | 対策（最終版） |
| :--- | :--- | :--- |
| **10. 最終的な環境設定** | 競合を完全に排除し、意図した通りにターミナル版を安定して起動させる必要があった。 | **1. 拡張機能の無効化:** 競合の原因であるGUI用`Claude Code`拡張機能を無効にした。<br>**2. PowerShellプロファイルの最適化:** `$PROFILE`の内容を`function claude { wsl.exe -e bash -ic "claude" }`という、最も確実な記述に修正。`-ic`オプションにより、WSL起動時にLinuxの設定ファイルが確実に読み込まれるようにした。 |

## 3. 料金に関する確認

-   **質問:** Proプラン（月額固定）を契約しているが、`Claude Code`を多用すると追加請求される可能性はあるか？
-   **回答:** **基本的にその心配はない。**
    -   Proプランは、月額固定料金で広大な利用枠を購入するサブスクリプションモデル。
    -   利用量に応じて請求額が増えるのは、APIキーを使った従量課金モデルの場合。
    -   Proプランの認証で利用しているため、請求は月額料金で完結する。安心して利用可能。

## 4. 今後の基本的な使い方

以上の設定により、以下の簡単な手順でいつでも`Claude Code`を起動できる環境が整いました。

1.  **Cursorを起動する。**
2.  **ターミナルを開く** (ショートカット: `Ctrl + @`)。
3.  ターミナルに `claude` と入力して `Enter` キーを押す。

---
以上が、本件における対応の全容となります。このドキュメントが、今後の運用やチーム内での情報共有にお役立てできれば幸いです。