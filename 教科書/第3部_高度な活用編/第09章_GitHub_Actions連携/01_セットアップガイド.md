# セットアップガイド

## はじめに

GitHub Actions連携により、GitHubのIssueやPull Requestで `@claude` とメンションするだけで、Claude AIがコードレビュー、質問への回答、実装などを自動で行ってくれます。この章では、セットアップの全体像と必要なものを解説します。

## Claude GitHub Actionとは

### 概要

**Claude GitHub Action**は、GitHub上でClaude AIを活用できる公式のGitHub Actionsです。

**実現できること:**
- ✅ Issueでの質問に自動回答
- ✅ Pull Requestの自動レビュー
- ✅ コードの実装・修正
- ✅ ブランチの自動作成
- ✅ コミットとPRの自動作成

### 料金

| 認証方法 | 対象ユーザー | 料金 |
|---------|------------|------|
| **OAuth Token** | Claude Pro/Max | サブスクリプションに含まれる（追加料金なし） |
| **API Key** | 全ユーザー | 従量課金 |

**推奨:** Pro/Maxユーザーは OAuth Token を使用

## 全体像

### セットアップの3ステップ

```
ステップ1: Claude GitHub Appのインストール
    ↓
ステップ2: 認証情報の設定（OAuth Token）
    ↓
ステップ3: ワークフローファイルの作成
```

### 必要なもの

#### 必須要件

- [x] GitHubアカウント
- [x] リポジトリの管理者権限
- [x] Claude Pro/Maxプラン（OAuth Token使用の場合）
- [x] Node.js + npm（OAuth Token生成用）

#### 推奨環境

- **OS**: Windows、macOS、Linux（いずれでも可）
- **シェル**: PowerShell、Bash、Zshなど
- **Git**: インストール済み

## セットアップフロー

### 詳細な流れ

```
【事前準備】
├── GitHubアカウント確認
├── Claude Pro/Maxプラン確認
└── 管理者権限の確認

【ステップ1】Claude GitHub Appのインストール（2分）
├── https://github.com/apps/claude にアクセス
├── 「Install」または「Configure」
├── リポジトリを選択
└── 権限を確認して「Install」

【ステップ2】OAuth Tokenの生成と設定（5分）
├── ローカル環境でトークン生成
│   └── npx claude setup-token
├── 表示されたトークンをコピー
├── GitHubのSecretsに追加
│   └── Name: CLAUDE_CODE_OAUTH_TOKEN
└── 保存

【ステップ3】ワークフローファイルの作成（3分）
├── .github/workflows/claude.yml を作成
├── 必要な設定を記述
├── git add, commit, push
└── GitHub Actionsで確認

【動作確認】
├── Issueを作成
├── @claude こんにちは！ とコメント
└── Claudeが自動で返信
```

### 所要時間

- **初回セットアップ**: 約10-15分
- **2回目以降**（別のリポジトリ）: 約2-3分

## セットアップ時の注意点

### 権限について

Claude GitHub Appは以下の権限を必要とします：

**最小限の権限:**
- ✅ Contents: Read & Write（コードの読み書き）
- ✅ Issues: Read & Write（Issue操作）
- ✅ Pull requests: Read & Write（PR操作）

**推奨する設定:**
- 「Only select repositories」を選択
- 必要なリポジトリのみに制限（セキュリティの原則）

### OAuth Token vs API Key

| 項目 | OAuth Token | API Key |
|------|------------|---------|
| **対象** | Pro/Maxユーザー | 全ユーザー |
| **料金** | 無料（サブスク含む） | 従量課金 |
| **有効期限** | 1年間 | 無期限 |
| **セキュリティ** | 短期トークン（相対的） | 長期キー |
| **生成方法** | `npx claude setup-token` | Anthropic Console |
| **Secret名** | `CLAUDE_CODE_OAUTH_TOKEN` | `ANTHROPIC_API_KEY` |

**推奨:** Pro/Maxユーザーは OAuth Token を使用

### セキュリティのベストプラクティス

1. **トークンを安全に管理**
   - コードにコミットしない
   - チャットやメールで送信しない
   - スクリーンショットに含めない

2. **最小権限の原則**
   - 必要なリポジトリのみにアクセス許可
   - 不要なリポジトリは除外

3. **定期的な見直し**
   - 年1回、アクセス権限を見直す
   - 不要になったリポジトリは削除

## トラブルシューティング（概要）

### よくある問題

**問題1: Claudeが応答しない**
- GitHub Actionsが実行されているか確認
- ワークフローのログを確認
- `@claude` が含まれているか確認

**問題2: `fatal: not a git repository`**
- ワークフローに `actions/checkout@v4` が含まれているか確認

**問題3: OAuth Tokenが期限切れ**
- 新しいトークンを生成
- GitHubのSecretを更新

**詳細は第6章で解説します。**

## 環境別の注意点

### Windows環境

**推奨:** PowerShellで実行

- ✅ 日本語パスの問題が起きない
- ✅ シンプル

### WSL環境

**注意点:**
- パスの変換が必要（`G:\` → `/mnt/g/`）
- 日本語パスで問題が起きる可能性

**推奨:** 通常のWindows PowerShellで実行

### macOS/Linux環境

**推奨:** デフォルトのターミナル

- ✅ 特別な設定不要
- ✅ そのまま実行可能

## 次のステップ

セットアップの全体像を理解したら、次の章から実際の手順を進めます。

### 章の構成

- **第2章**: Claude GitHub Appのインストール
- **第3章**: OAuth Tokenの設定
- **第4章**: ワークフローファイルの作成
- **第5章**: 自動PRレビューの設定
- **第6章**: トラブルシューティング

### 準備

次の章に進む前に、以下を確認してください：

- [ ] GitHubアカウントがある
- [ ] Claude Pro/Maxプランに加入している
- [ ] 設定するリポジトリの管理者権限がある
- [ ] Node.jsとnpmがインストールされている

```bash
# Node.jsのバージョン確認
node --version
npm --version
```

## まとめ

### 重要なポイント

1. **3ステップで完了**: App インストール → Token 設定 → ワークフロー作成
2. **所要時間**: 初回 10-15分、2回目以降 2-3分
3. **推奨**: Pro/Maxユーザーは OAuth Token
4. **セキュリティ**: 最小権限の原則を守る

### 次章の内容

次の章では、Claude GitHub Appのインストール手順を詳しく解説します。スクリーンショット付きで、迷わずインストールできるようにガイドします。
