# A4. カスタムコマンド例

## カスタムコマンドとは

Claude Codeでは、`.claude/commands/`ディレクトリにマークダウンファイルを配置することで、独自のスラッシュコマンドを作成できます。

**配置場所:**
```bash
<project-root>/.claude/commands/
```

---

## 基本的なコマンドの構造

```markdown
# コマンド名

コマンドの説明

## 実行内容
具体的な指示内容
```

---

## 開発フロー系コマンド

### /review-code - コードレビュー

**ファイル名:** `.claude/commands/review-code.md`

```markdown
# コードレビュー

変更されたファイルを包括的にレビューします。

## レビュー項目
1. コードの品質と可読性
2. 潜在的なバグやエラーハンドリングの問題
3. パフォーマンスの問題
4. セキュリティの脆弱性
5. テストカバレッジ
6. ベストプラクティスへの準拠

## 実行手順
1. git diff で変更されたファイルを確認
2. 各ファイルの変更内容を分析
3. 問題点と改善提案をリストアップ
4. 重要度（Critical/High/Medium/Low）で分類
5. 具体的なコード例を示す

## 出力形式
- 📌 Critical: 修正必須（セキュリティ、バグ）
- ⚠️ High: 優先度高（パフォーマンス、保守性）
- 💡 Medium: 推奨（リファクタリング、最適化）
- 📝 Low: 改善案（コードスタイル、命名）
```

### /add-tests - テスト追加

**ファイル名:** `.claude/commands/add-tests.md`

```markdown
# テスト追加

指定されたファイルに対して、包括的な単体テストを作成します。

## テスト作成ルール
- AAA（Arrange-Act-Assert）パターンを使用
- 正常系、異常系、境界値をカバー
- テストケース名は振る舞いを説明的に記述
- モックは最小限に抑える
- 各テストは独立して実行可能

## テスト項目
1. 正常系のテスト
2. エラーケースのテスト
3. 境界値のテスト
4. エッジケースのテスト

## 使用フレームワーク
- TypeScript/JavaScript: Jest, Vitest
- Python: pytest
- Go: testing package

## 実行後の確認
- テストを実行して全て通過することを確認
- カバレッジレポートを確認
```

### /refactor - リファクタリング

**ファイル名:** `.claude/commands/refactor.md`

```markdown
# リファクタリング

指定されたコードを、動作を変えずに改善します。

## リファクタリング項目
1. 重複コードの削除（DRY原則）
2. 長い関数の分割
3. 複雑な条件式の簡略化
4. マジックナンバーの定数化
5. 意味不明な変数名の改善
6. ネストの削減

## ルール
- 既存のテストが全て通過することを確認
- 一度に大きな変更をせず、小さなステップで
- リファクタリング前後で動作が同じことを保証
- コミットメッセージは "refactor: " で開始

## 実行手順
1. 現在のテストを実行して通過を確認
2. リファクタリングを実施
3. テストを再実行して通過を確認
4. git diff で変更を確認
```

---

## ドキュメント生成系コマンド

### /gen-readme - README生成

**ファイル名:** `.claude/commands/gen-readme.md`

```markdown
# README生成

プロジェクトのREADME.mdを自動生成します。

## 含める内容
1. プロジェクト名と説明
2. 主な機能
3. 技術スタック
4. インストール手順
5. 使用方法
6. 設定方法
7. テストの実行方法
8. ディレクトリ構造
9. ライセンス情報
10. コントリビューションガイド（該当する場合）

## 生成ルール
- package.jsonから情報を抽出
- 既存のREADMEがある場合は内容を保持
- コードブロックにはシンタックスハイライトを使用
- スクリーンショットやデモへのリンクを含める（該当する場合）

## フォーマット
```markdown
# プロジェクト名

簡潔な説明

## Features
- 機能1
- 機能2

## Tech Stack
- Framework
- Database
- etc.

## Installation
\`\`\`bash
npm install
\`\`\`

## Usage
\`\`\`bash
npm run dev
\`\`\`

## Configuration
環境変数の設定など

## Testing
\`\`\`bash
npm test
\`\`\`

## License
ライセンス情報
```

### /gen-api-docs - APIドキュメント生成

**ファイル名:** `.claude/commands/gen-api-docs.md`

```markdown
# APIドキュメント生成

REST APIのドキュメントを自動生成します。

## 生成内容
- エンドポイント一覧
- リクエスト/レスポンス形式
- 認証方法
- エラーレスポンス
- 使用例

## フォーマット
各エンドポイントについて以下を記載:

```markdown
### POST /api/users

ユーザーを新規作成します。

**Authentication:** Required (Bearer Token)

**Request Body:**
\`\`\`json
{
  "email": "user@example.com",
  "name": "John Doe",
  "password": "secure_password"
}
\`\`\`

**Response (201 Created):**
\`\`\`json
{
  "success": true,
  "data": {
    "id": "123",
    "email": "user@example.com",
    "name": "John Doe",
    "createdAt": "2025-11-13T00:00:00Z"
  }
}
\`\`\`

**Error Responses:**
- 400 Bad Request: バリデーションエラー
- 409 Conflict: メールアドレスが既に存在
- 500 Internal Server Error: サーバーエラー
```

## 実行手順
1. ルートファイルを解析してエンドポイントを抽出
2. コントローラーやバリデーションから詳細を取得
3. Markdown形式でドキュメント生成
4. docs/api.md に保存
```

---

## 品質チェック系コマンド

### /quality-check - 品質チェック

**ファイル名:** `.claude/commands/quality-check.md`

```markdown
# 品質チェック

コードベース全体の品質をチェックします。

## チェック項目
1. リント（ESLint/Pylint等）
2. フォーマット（Prettier/Black等）
3. 型チェック（TypeScript/mypy等）
4. テストカバレッジ
5. セキュリティ脆弱性（npm audit等）
6. 未使用の依存関係
7. 循環依存
8. コード複雑度

## 実行コマンド
```bash
# リント
npm run lint

# フォーマットチェック
npm run format:check

# 型チェック
npm run type-check

# テスト
npm run test

# カバレッジ
npm run test:coverage

# セキュリティ監査
npm audit

# 未使用依存関係チェック
npx depcheck
```

## レポート生成
問題点をカテゴリ別に集計し、優先度を付けて報告
```

### /security-check - セキュリティチェック

**ファイル名:** `.claude/commands/security-check.md`

```markdown
# セキュリティチェック

セキュリティ上の問題をチェックします。

## チェック項目
1. ハードコードされた機密情報（APIキー、パスワード等）
2. SQLインジェクションの可能性
3. XSS脆弱性
4. CSRF対策の有無
5. 認証・認可の実装
6. HTTPSの使用
7. セキュアなヘッダーの設定
8. 依存関係の脆弱性

## 実行内容
1. コードベースをスキャン
2. 機密情報のパターンマッチング
3. npm audit / pip-audit 実行
4. 既知の脆弱性パターンをチェック
5. 結果をレポート

## 対処方法も提示
- 見つかった問題の修正方法
- ベストプラクティスの提案
- 参考リンク
```

---

## Git操作系コマンド

### /prepare-pr - PR準備

**ファイル名:** `.claude/commands/prepare-pr.md`

```markdown
# PR準備

プルリクエストを作成するための準備を行います。

## 実行内容
1. 変更ファイルの確認（git status）
2. 差分の確認（git diff）
3. コミットメッセージの生成
4. PR説明文の生成
5. チェックリストの作成

## PR説明文のフォーマット
```markdown
## 変更内容
- 変更1
- 変更2

## 変更理由
なぜこの変更が必要か

## テスト
- [ ] 単体テストを追加/更新
- [ ] テストが全て通過
- [ ] 手動テストを実施

## チェックリスト
- [ ] コードレビュー準備完了
- [ ] ドキュメント更新済み
- [ ] 破壊的変更の有無を確認
- [ ] パフォーマンスへの影響を確認

## スクリーンショット（該当する場合）
```

## 自動実行
- git add で変更をステージング
- コンベンショナルコミット形式でコミット
- gh pr create でPR作成（オプション）
```

### /commit-smart - スマートコミット

**ファイル名:** `.claude/commands/commit-smart.md`

```markdown
# スマートコミット

変更内容を分析して、適切なコミットメッセージを生成します。

## 実行手順
1. git diff で変更内容を確認
2. 変更の種類を判定（feat/fix/refactor/docs等）
3. 変更の本質を要約
4. コンベンショナルコミット形式でメッセージ生成

## コミットメッセージ形式
```
<type>(<scope>): <subject>

<body>

<footer>
```

## タイプの判定基準
- feat: 新機能追加
- fix: バグ修正
- refactor: リファクタリング
- docs: ドキュメント変更
- test: テスト追加/修正
- style: コードスタイル変更
- perf: パフォーマンス改善
- chore: ビルド・ツール変更

## 自動実行
生成したメッセージでgit commitを実行
```

---

## デバッグ・調査系コマンド

### /analyze-error - エラー分析

**ファイル名:** `.claude/commands/analyze-error.md`

```markdown
# エラー分析

エラーメッセージやスタックトレースを分析して、原因と解決策を提示します。

## 実行内容
1. エラーメッセージの解析
2. スタックトレースの分析
3. 関連ファイルの確認
4. 類似の既知の問題を検索
5. 原因の特定
6. 解決策の提案

## 分析項目
- エラーの種類
- 発生箇所
- 考えられる原因
- 修正方法（複数提示）
- 予防策

## 出力形式
```markdown
## エラー概要
[エラーメッセージ]

## 原因
[詳細な原因分析]

## 解決策
### 方法1（推奨）
[具体的な修正内容とコード例]

### 方法2（代替案）
[別のアプローチ]

## 予防策
[同様のエラーを防ぐための対策]
```
```

### /find-bottleneck - ボトルネック発見

**ファイル名:** `.claude/commands/find-bottleneck.md`

```markdown
# ボトルネック発見

パフォーマンスのボトルネックを特定し、最適化案を提示します。

## チェック項目
1. N+1クエリ問題
2. 不要なループ
3. 重い計算処理
4. メモリリーク
5. 非効率なアルゴリズム
6. 不要な再レンダリング（React等）
7. 大きなバンドルサイズ

## 実行内容
1. コードベースをスキャン
2. パフォーマンス問題のパターンを検出
3. プロファイリング結果の分析（ある場合）
4. 改善案の提示

## 改善案の形式
- 問題箇所の特定
- 現在の実装
- 最適化後の実装例
- 期待される改善効果
```

---

## プロジェクト管理系コマンド

### /project-status - プロジェクトステータス

**ファイル名:** `.claude/commands/project-status.md`

```markdown
# プロジェクトステータス

プロジェクトの現在の状態を包括的に報告します。

## 報告内容
1. Git状態
   - ブランチ名
   - コミット数
   - 未コミットの変更
2. テスト状況
   - テスト実行結果
   - カバレッジ
3. ビルド状況
4. 依存関係
   - アップデート可能なパッケージ
   - セキュリティ脆弱性
5. TODO/FIXMEコメント数
6. 技術的負債の指標
7. ファイル統計

## 実行コマンド
```bash
git status
npm test
npm run build
npm outdated
npm audit
grep -r "TODO\|FIXME" src/
```

## 出力形式
```markdown
# プロジェクトステータスレポート

## Git
- ブランチ: feature/xxx
- 未コミット: 5ファイル

## テスト
- ✅ 全テスト通過 (127/127)
- カバレッジ: 85%

## ビルド
- ✅ ビルド成功

## 依存関係
- アップデート可能: 12パッケージ
- ⚠️ セキュリティ脆弱性: 2件

## TODO/FIXME
- TODO: 23件
- FIXME: 5件

## 推奨アクション
1. セキュリティ脆弱性の修正
2. FIXMEコメントの対処
```
```

---

## 使い方

### コマンドの作成

```bash
# コマンドディレクトリを作成
mkdir -p .claude/commands

# コマンドファイルを作成
nano .claude/commands/review-code.md

# 上記のテンプレートをコピー&ペースト
```

### コマンドの実行

```bash
# Claude Codeで
/review-code

# またはファイルを指定
/add-tests src/services/user.service.ts
```

---

## まとめ

カスタムコマンドを活用することで、繰り返し行う作業を効率化し、一貫性のある開発フローを実現できます。

**ポイント:**
- プロジェクトの特性に合わせてカスタマイズ
- チーム全体で共有
- 定期的に見直して改善

次は、サブエージェント例（A5）で高度な活用方法を学びましょう。
