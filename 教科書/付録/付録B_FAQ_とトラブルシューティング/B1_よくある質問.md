# B1. よくある質問

## インストールと設定

### Q1: Claude Codeのインストールが失敗します

**A:** 以下を順番に確認してください:

```bash
# Node.jsのバージョン確認（18以上が必要）
node --version

# npmのバージョン確認
npm --version

# グローバルインストールの権限確認
npm config get prefix

# キャッシュをクリア
npm cache clean --force

# 再度インストール
npm install -g @anthropic-ai/claude-code
```

**WSL環境の場合:**
```bash
# WSL内でNode.jsがインストールされているか確認
which node

# インストールされていない場合
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs
```

---

### Q2: APIキーの設定方法が分かりません

**A:** Claude Codeの初回起動時に自動的にプロンプトが表示されます:

```bash
# Claude Codeを起動
claude-code

# APIキーの入力を求められる
# https://console.anthropic.com/ でAPIキーを取得
# 入力すると ~/.claude/config.json に保存される
```

**手動で設定する場合:**
```bash
# 設定ファイルを直接編集
nano ~/.claude/config.json

# 以下の内容を追加
{
  "apiKey": "sk-ant-api03-YOUR_API_KEY_HERE"
}
```

---

### Q3: 複数のプロジェクトで異なる設定を使いたい

**A:** プロジェクトごとに `.claude/` ディレクトリを作成します:

```bash
# プロジェクトAの設定
project-a/
└── .claude/
    ├── CLAUDE.md
    └── settings.json

# プロジェクトBの設定
project-b/
└── .claude/
    ├── CLAUDE.md
    └── settings.json
```

設定の優先順位:
1. プロジェクトルートの `.claude/`（最優先）
2. ホームディレクトリの `~/.claude/`
3. デフォルト設定

---

## 使用方法

### Q4: Claude Codeとカーソルの違いは何ですか？

**A:**

| 項目 | Claude Code | Cursor |
|------|-------------|--------|
| インターフェース | ターミナル（CLI） | VS Codeベース（GUI） |
| 料金 | Anthropic APIの従量課金 | 月額サブスクリプション |
| モデル選択 | Claude全モデル | 複数AIモデル対応 |
| オフライン | 不可 | 不可 |
| カスタマイズ | CLAUDE.md, settings.json | .cursorrules, settings.json |
| コード生成 | ○ | ○ |
| ファイル編集 | ○ | ○ |
| Git統合 | ○ | ○ |

**どちらを選ぶべきか:**
- CLI操作に慣れている → Claude Code
- GUI環境が好き → Cursor
- 最新のClaudeモデルを使いたい → Claude Code
- 複数のAIモデルを試したい → Cursor

---

### Q5: 一度に複数のファイルを編集できますか？

**A:** はい、可能です:

```bash
# 方法1: 明示的に指示
"""
以下のファイルを同時に更新してください:
1. src/components/Header.tsx - ロゴを変更
2. src/styles/header.css - スタイルを更新
3. tests/Header.test.tsx - テストを追加
"""

# 方法2: パターンマッチで指定
"""
src/components/*.tsx の全てのコンポーネントで
useStateをuseReducerに変更してください
"""
```

**制限:**
- 同時編集は10-20ファイル程度が実用的
- 大量のファイル変更は複数回に分けて実行推奨

---

### Q6: Claude Codeの応答を途中で止めたい

**A:**

```bash
# Ctrl + C を押す
# または
# Ctrl + D を押す

# セッションを完全に終了したい場合
exit
# または
quit
```

---

### Q7: 前の会話を参照したい

**A:**

```bash
# セッション履歴の確認
/history

# 特定のセッションを再開
/resume <session-id>

# 履歴ファイルの場所
~/.claude/sessions/
```

---

## パフォーマンスと料金

### Q8: トークン使用量を確認したい

**A:**

```bash
# セッション中に確認
/tokens

# 現在のセッションの統計
/stats

# 月ごとの使用量（Anthropic Console）
https://console.anthropic.com/dashboard
```

**トークン消費の目安:**
- シンプルな質問: 100-500トークン
- コード生成: 1,000-3,000トークン
- 大規模リファクタリング: 5,000-10,000トークン
- ファイル全体の解析: 2,000-5,000トークン

---

### Q9: 料金を節約するコツはありますか？

**A:**

**1. モデルを使い分ける:**
```bash
# 簡単なタスクは Haikuモデル（安い）
/model claude-3-haiku

# 複雑なタスクは Sonnet/Opus（高性能）
/model claude-sonnet-4
```

**2. コンテキストを最小化:**
```bash
# 必要なファイルだけを含める
/context src/specific-file.ts

# 不要なファイルを除外
ignoreDirs: ["node_modules", "dist", "build"]
```

**3. プラン機能を活用:**
```bash
# Plan modeで事前に計画
/plan タスクの詳細

# 計画を確認してから実行
/execute
```

**4. 大きなタスクを分割:**
```bash
# ❌ 一度に全て依頼
"""
アプリ全体をリファクタリングしてください
"""

# ✅ 小さく分割
"""
まず UserService をリファクタリングしてください
"""
```

---

### Q10: 応答が遅い、または途中で止まります

**A:**

**原因と対策:**

1. **ネットワーク接続の問題**
```bash
# 接続確認
ping console.anthropic.com

# プロキシ設定（必要な場合）
export HTTP_PROXY=http://proxy.example.com:8080
export HTTPS_PROXY=http://proxy.example.com:8080
```

2. **タイムアウト設定**
```json
// settings.json
{
  "timeout": 120000,  // 120秒
  "retryAttempts": 3
}
```

3. **大きすぎるコンテキスト**
```bash
# ファイルサイズを確認
du -sh .claude/context/

# コンテキストをクリア
/clear-context
```

---

## 機能に関する質問

### Q11: 画像を見せることはできますか？

**A:** はい、可能です:

```bash
# 方法1: ファイルパスを指定
"""
この画像のエラーメッセージを解析してください:
/home/user/screenshots/error.png
"""

# 方法2: ドラッグ&ドロップ（環境による）
# 画像ファイルをターミナルにドロップ

# 方法3: Base64エンコード
"""
[Image: data:image/png;base64,iVBORw0KG...]
"""
```

**WSL環境の場合:**
- Windowsパスは自動変換される（CLAUDE.md設定が必要）
- `C:\Users\...\image.png` → `/mnt/c/Users/.../image.png`

---

### Q12: 音声入力は使えますか？

**A:** はい、Claude Codeは音声入力に対応しています:

```bash
# 音声入力を開始
/voice

# または
# スペースキーを長押しして話す

# 音声入力を停止
# スペースキーを離す
```

**設定:**
```json
// settings.json
{
  "voice": {
    "enabled": true,
    "language": "ja-JP",
    "autoDetect": true
  }
}
```

**注意:**
- マイクへのアクセス許可が必要
- ネットワーク接続が必要（音声認識はクラウドで処理）

---

### Q13: GitHubと連携できますか？

**A:** はい、GitHub Actionsとの連携が可能です:

```bash
# GitHubアプリのインストール
# 1. https://github.com/apps/claude-code
# 2. リポジトリにインストール

# PR作成
/pr create

# PR確認
/pr list

# Issue確認
/issue list
```

**GitHub Actionsワークフロー:**
```yaml
name: Claude Code Review
on: [pull_request]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: anthropic-ai/claude-code-action@v1
        with:
          api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          command: review
```

---

### Q14: テストを自動実行できますか？

**A:** はい、カスタムコマンドやHooksで可能です:

```bash
# テスト実行コマンド
/test

# テスト＋カバレッジ
/test-coverage
```

**Hooks設定:**
```markdown
# .claude/hooks/pre-commit.md

コミット前に以下を実行:
1. npm run lint
2. npm run test
3. テストが失敗したらコミットを中止
```

---

## トラブルシューティング

### Q15: "Permission denied"エラーが出ます

**A:**

```bash
# ファイルの権限確認
ls -la .claude/

# 権限を修正
chmod 755 ~/.claude
chmod 644 ~/.claude/config.json

# 所有者を確認
ls -l ~/.claude/config.json

# 所有者を変更（必要な場合）
sudo chown $USER:$USER ~/.claude/config.json
```

---

### Q16: CLAUDE.mdの変更が反映されません

**A:**

```bash
# 1. ファイル名を確認（大文字小文字重要）
ls -la .claude/CLAUDE.md

# 2. 構文エラーがないか確認
cat .claude/CLAUDE.md

# 3. Claude Codeを完全に再起動
exit
claude-code

# 4. キャッシュをクリア
rm -rf ~/.claude/cache
```

---

### Q17: コード生成が期待と違います

**A:**

**より具体的に指示する:**
```bash
# ❌ 曖昧な指示
"""
ログイン機能を作ってください
"""

# ✅ 具体的な指示
"""
以下の仕様でログイン機能を実装してください:
- メールアドレスとパスワードで認証
- JWT トークンを発行
- バリデーションはZodを使用
- エラーハンドリングを実装
- テストも作成
"""
```

**CLAUDE.mdで方針を明確化:**
```markdown
## 認証の実装方針
- JWT を使用
- トークンの有効期限: 7日間
- リフレッシュトークンも実装
```

---

### Q18: "Rate limit exceeded"エラーが出ます

**A:**

```bash
# レート制限の確認
# Anthropic API: Claude Sonnetで50リクエスト/分

# 対策1: モデルを変更
/model claude-3-haiku  # より高い制限

# 対策2: リクエスト間隔を空ける
# 連続で大量のリクエストを避ける

# 対策3: プランをアップグレード
# Anthropic Consoleでプランを確認
```

---

## 高度な使い方

### Q19: サブエージェントとは何ですか？

**A:** 特定のタスクに特化したエージェントです:

```bash
# サブエージェントの作成
.claude/agents/code-reviewer/
├── CLAUDE.md          # エージェントの役割と設定
└── settings.json      # パーミッション設定

# サブエージェントの呼び出し
/agent code-reviewer

# サブエージェントの一覧
/agents list
```

**使い分けの例:**
- `code-reviewer`: コードレビュー専門
- `debugger`: デバッグ専門
- `test-runner`: テスト作成・実行専門
- `documenter`: ドキュメント作成専門

---

### Q20: MCPとは何ですか？

**A:** Model Context Protocol（MCP）は、外部ツールやサービスとの統合機能です:

```bash
# MCPサーバーの設定
.claude/mcp.json

# 例: Slackとの連携
{
  "slack": {
    "enabled": true,
    "token": "xoxb-your-token",
    "channel": "#notifications"
  }
}

# 使用例
"""
このエラーをSlackに報告してください
"""
```

**対応するMCPサーバー:**
- Slack
- GitHub
- Linear
- Notion
- PostgreSQL
- MongoDB
- カスタムサーバー

---

## セキュリティ

### Q21: APIキーが漏洩した場合はどうすればいいですか？

**A:**

```bash
# 1. 即座にAPIキーを無効化
# Anthropic Console: https://console.anthropic.com/
# Settings → API Keys → Revoke

# 2. 新しいAPIキーを生成

# 3. ローカルの設定を更新
nano ~/.claude/config.json

# 4. Gitのコミット履歴を確認
git log -p | grep "sk-ant-api"

# 5. 漏洩していた場合はリポジトリをクリーンアップ
git filter-repo --invert-paths --path config.json
```

---

### Q22: 機密情報をClaude Codeに渡しても安全ですか？

**A:**

**Anthropicのプライバシーポリシー:**
- データは学習に使用されない
- 通信は暗号化（HTTPS）
- API経由のデータは30日後に削除

**推奨事項:**
```bash
# 1. .env ファイルは常にdenyに設定
{
  "permissions": {
    "deny": {
      "read": [".env", ".env.local", "*.key", "*.pem"]
    }
  }
}

# 2. 機密情報はマスクして渡す
"""
このエラーログを分析してください:
[2025-11-13] User: ****@example.com
[2025-11-13] Token: ****
[2025-11-13] Error: Connection failed
"""

# 3. 本番データは使用しない
# テストデータやサンプルデータを使用
```

---

## その他

### Q23: オフラインで使用できますか？

**A:** いいえ、Claude CodeはAnthropicのAPIを使用するため、インターネット接続が必要です。

**代替案:**
- ローカルLLMを使用する（Ollama + Code Llama等）
- オフライン用のコードスニペット集を用意
- よく使うコマンドをスクリプト化

---

### Q24: チームで設定を共有したい

**A:**

```bash
# 1. プロジェクトルートに .claude/ を作成
mkdir -p .claude

# 2. 設定ファイルを配置
.claude/
├── CLAUDE.md
├── settings.json
├── commands/
└── agents/

# 3. Gitにコミット
git add .claude/
git commit -m "chore: add Claude Code configuration"

# 4. .gitignore で個人設定は除外
echo ".claude/cache" >> .gitignore
echo ".claude/sessions" >> .gitignore
```

---

### Q25: ログはどこに保存されますか？

**A:**

```bash
# ログファイルの場所
~/.claude/logs/

# ログの確認
tail -f ~/.claude/logs/claude-code.log

# セッション履歴
~/.claude/sessions/

# キャッシュ
~/.claude/cache/
```

**ログレベルの設定:**
```json
// settings.json
{
  "logLevel": "debug",  // debug, info, warn, error
  "logFile": "~/.claude/logs/custom.log"
}
```

---

## まとめ

よくある質問の多くは、設定ファイルの調整やコマンドの使い方で解決できます。

**問題解決の基本フロー:**
1. エラーメッセージを確認
2. 設定ファイルをチェック
3. キャッシュをクリア
4. Claude Codeを再起動
5. 公式ドキュメントを参照

それでも解決しない場合は、次章のエラー別トラブルシューティングを参照してください。
